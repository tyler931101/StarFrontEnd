<div class="container">
    <h1>User Management</h1>
    <!-- Filters and Search -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-6">
                    <app-search [placeholder]="'Search by username, email, or phone'" [debounceTime]="300"
                        (search)="onSearch($event)"></app-search>
                </div>
                <div class="col-md-6">
                    <div class="d-flex justify-content-md-end">
                        <div class="filter-section">
                            <label class="form-label me-2">Status:</label>
                            <select class="form-select w-auto d-inline-block" [value]="statusFilter"
                                (change)="onStatusFilterChange($event)">
                                <option value="">All</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="pending">Pending</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Users Table -->
    <div class="card">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Status</th>
                            <th>Role</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngIf="isLoading">
                            <td colspan="8" class="text-center py-5">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </td>
                        </tr>
    
                        <tr *ngFor="let user of users">
                            <td>{{ user.id }}</td>
                            <td>{{ user.username }}</td>
                            <td>{{ user.email }}</td>
                            <td>{{ user.phone }}</td>
                            <td>
                                <span class="badge" [ngClass]="getStatusBadgeClass(user.status)">
                                    {{ user.status | titlecase }}
                                </span>
                            </td>
                            <td>
                                <span class="badge" [ngClass]="getRoleBadgeClass(user.role)">
                                    {{ user.role | titlecase }}
                                </span>
                            </td>
                            <td>{{ user.createdAt | date:'shortDate' }}</td>
                            <td>
                                <div class="btn-group btn-group-sm" role="group">
                                    <button class="btn btn-outline-primary" (click)="openEditModal(user)">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-outline-danger" (click)="openDeleteModal(user)">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
    
                        <tr *ngIf="!isLoading && users.length === 0">
                            <td colspan="8" class="text-center py-5 text-muted">
                                No users found
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
    
            <!-- Pagination -->
            <app-pagination *ngIf="totalUsers > 0" [currentPage]="currentPage" [totalItems]="totalUsers"
                [pageSize]="pageSize" [totalPages]="totalPages" (pageChange)="onPageChange($event)"
                (pageSizeChange)="onPageSizeChange($event)"></app-pagination>
        </div>
    </div>
    
    <!-- Edit User Modal -->
    <app-modal *ngIf="isEditModalVisible" [title]="'Edit User: ' + (selectedUser?.username || '')" size="md"
        [isVisible]="isEditModalVisible" [confirmDisabled]="userForm.invalid || isLoading" confirmText="Save Changes"
        (confirm)="saveUser()" (closeModal)="closeEditModal()">
        <form [formGroup]="userForm">
            <div class="mb-3">
                <label class="form-label">Username</label>
                <input type="text" class="form-control" formControlName="username">
                <div *ngIf="userForm.get('username')?.invalid && userForm.get('username')?.touched" class="text-danger">
                    Username is required and must be at least 3 characters
                </div>
            </div>
    
            <div class="mb-3">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" formControlName="email">
                <div *ngIf="userForm.get('email')?.invalid && userForm.get('email')?.touched" class="text-danger">
                    Valid email is required
                </div>
            </div>
    
            <div class="mb-3">
                <label class="form-label">Phone</label>
                <input type="tel" class="form-control" formControlName="phone">
                <div *ngIf="userForm.get('phone')?.invalid && userForm.get('phone')?.touched" class="text-danger">
                    Phone number is required
                </div>
            </div>
    
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Status</label>
                    <select class="form-select" formControlName="status">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                        <option value="pending">Pending</option>
                    </select>
                </div>
    
                <div class="col-md-6 mb-3">
                    <label class="form-label">Role</label>
                    <select class="form-select" formControlName="role">
                        <option value="user">User</option>
                        <option value="editor">Editor</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
            </div>
        </form>
    </app-modal>
    
    <!-- Delete Confirmation Modal -->
    <app-confirm *ngIf="isDeleteModalVisible" [title]="'Delete User'"
        [message]="'Are you sure you want to delete user ' + (selectedUser?.username || '') + '?'"
        [details]="'This action cannot be undone.'" type="warning" confirmText="Delete" cancelText="Cancel"
        confirmButtonClass="danger" [isVisible]="isDeleteModalVisible" (confirm)="confirmDelete()"
        (closeModal)="closeDeleteModal()"></app-confirm>
</div>