<div class="container">
    <h1>Calendar</h1>

    <div class="main-content">
        <div class="cal-toolbar">
            <button class="btn" (click)="prevMonth()">Prev</button>
            <div class="month-label">{{ monthLabel }}</div>
            <button class="btn" (click)="nextMonth()">Next</button>
            <button class="btn" (click)="goToday()">Today</button>
            <button class="btn btn-primary" (click)="openCreateFromToolbar()">Schedule Event</button>
        </div>

        <div class="calendar">
            <div class="cal-head">
                <div class="cal-cell" *ngFor="let d of daysOfWeek">{{ d }}</div>
            </div>
            <div class="cal-body" [style.gridTemplateRows]="'repeat(' + weeks.length + ', minmax(110px, auto))'">
                <div class="cal-row" *ngFor="let w of weeks">
                    <div class="cal-cell cal-day" [class.out-month]="!d.inMonth" [class.today]="isToday(d.date)"
                        *ngFor="let d of w">
                        <div class="day-header">
                            <span class="day-num">{{ d.date.getDate() }}</span>
                        </div>
                        <div class="events">
                            <div class="event" *ngFor="let e of d.events" (click)="openEdit(e)"
                                [class.period]="e.endDate && e.endDate !== e.date" [style.background]="e.color">
                                <div class="event-title">{{ e.title }}</div>
                                <div class="event-time" *ngIf="e.start || e.end">{{ e.start || '' }}{{ e.end ? ' - ' + e.end :
                                    '' }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <app-modal [title]="editingEvent ? 'Edit Event' : 'Create Event'" [size]="'md'" [confirmText]="editingEvent ? 'Save' : 'Create'" [cancelText]="'Cancel'" [isVisible]="isEventModalVisible" (confirm)="saveEvent()" (closeModal)="closeEventModal()">
        <div class="form-group">
            <label class="form-label">Title</label>
            <input type="text" class="form-control" [(ngModel)]="formTitle" [class.invalid]="formAttempted && !formTitle.trim()">
            <div class="error-message" *ngIf="formAttempted && !formTitle.trim()">
                <small>Title is required.</small>
            </div>
        </div>
        <fieldset class="date-section">
            <legend>Select Date, Time</legend>
            <div class="form-group">
                    <label class="form-label">Start</label>
                    <input type="datetime-local" class="form-control" [(ngModel)]="formStartDateTime" [class.invalid]="formAttempted && !formDate">
                    <div class="error-message" *ngIf="formAttempted && !formDate">
                        <small>Start date is required.</small>
                    </div>
            </div>
            <div class="form-group" style="margin-bottom: 0;">
                <label class="form-label">End</label>
                <input type="datetime-local" class="form-control" [(ngModel)]="formEndDateTime" [class.invalid]="formAttempted && !formEndDate">
                <div class="error-message" *ngIf="formAttempted && !formEndDate">
                    <small>End date is required.</small>
                </div>
            </div>
        </fieldset>
        <div class="form-group">
            <label class="form-label">Description</label>
            <textarea rows="3" class="form-control" [(ngModel)]="formDescription" [class.invalid]="formAttempted && !formDescription.trim()"></textarea>
            <div class="error-message" *ngIf="formAttempted && !formDescription.trim()">
                <small>Description is required.</small>
            </div>
        </div>
        <div class="mt-2" *ngIf="editingEvent">
            <button class="btn btn-outline-danger" (click)="openDelete(editingEvent)">Delete</button>
        </div>
    </app-modal>

    <app-confirm *ngIf="isDeleteModalVisible" [title]="'Delete Event'" [message]="'Are you sure you want to delete ' + (editingEvent?.title || '') + '?'" [details]="'This action cannot be undone.'" type="warning" confirmText="Delete" cancelText="Cancel" confirmButtonClass="danger" [isVisible]="isDeleteModalVisible" (confirm)="confirmDelete()" (closeModal)="closeDeleteModal()"></app-confirm>
</div>
